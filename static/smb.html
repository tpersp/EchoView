<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Media Browser</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script>
    async function loadFolders() {
        const res = await fetch('/api/smb/folders');
        const data = await res.json();
        const list = document.getElementById('folders');
        list.innerHTML = '';
        if (data.folders) {
            data.folders.forEach(f => {
                const li = document.createElement('li');
                li.innerHTML = `<label><input type='checkbox' value='${f}' onchange='loadFiles("${f}", this.checked)'> ${f}</label>`;
                const files = document.createElement('ul');
                files.id = `files_${f}`;
                files.className = 'grid hidden';
                li.appendChild(files);
                list.appendChild(li);
            });
        } else {
            list.innerHTML = 'Error: ' + (data.error || 'Unknown');
        }
    }
    async function selectFolders() {
        const checked = Array.from(document.querySelectorAll('#folders input:checked')).map(i => i.value);
        await fetch('/api/smb/select', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(checked)
        });
        loadMix();
    }

    async function loadFiles(folder, show) {
        const container = document.getElementById('files_' + folder);
        if (!show) { container.classList.add('hidden'); return; }
        const res = await fetch('/api/smb/files/' + encodeURIComponent(folder));
        const data = await res.json();
        container.innerHTML = '';
        container.classList.remove('hidden');
        if (data.files) {
            data.files.forEach(f => {
                const li = document.createElement('li');
                li.className = 'item card p-2 text-center';
                const thumb = document.createElement('img');
                thumb.src = '/media/' + folder + '/' + f;
                thumb.className = 'thumb card-img-top';
                const btn = document.createElement('button');
                btn.textContent = 'Show';
                btn.className = 'btn btn-sm btn-primary mt-1';
                btn.onclick = () => fetch('/api/display/' + encodeURIComponent(folder + '/' + f), {method:'POST'});
                li.appendChild(thumb);
                li.appendChild(document.createTextNode(f));
                li.appendChild(document.createElement('br'));
                li.appendChild(btn);
                container.appendChild(li);
            });
        }
    }

    async function loadMix() {
        const res = await fetch('/api/smb/mix');
        const data = await res.json();
        const list = document.getElementById('mix');
        list.innerHTML = '';
        if (data.files) {
            data.files.forEach(f => {
                const li = document.createElement('li');
                li.textContent = f;
                list.appendChild(li);
            });
        }
    }

    window.onload = loadFolders;
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-3">
        <div class="container-fluid">
            <a class="navbar-brand" href="/static/">EchoView</a>
            <div class="navbar-nav">
                <a class="nav-link" href="/static/">Home</a>
                <a class="nav-link" href="/static/smb.html">Media</a>
                <a class="nav-link" href="/static/display.html">Display</a>
            </div>
        </div>
    </nav>
    <div class="container">
        <h1 class="my-3">Media Browser</h1>
        <ul id="folders" class="list-unstyled"></ul>
        <button class="btn btn-primary" onclick="selectFolders()">Select Folders</button>
        <h2 class="mt-4">Mixed Files</h2>
        <ul id="mix" class="list-unstyled"></ul>
    </div>
</body>
</html>
